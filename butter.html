<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Contest</title>

    <link rel="stylesheet" href="/butter.css">
</head>

<body>
    <div class="header">
        <div class="title">
            <h1>Star Diet</h1>
        </div>
    </div>

    <div class="sidebar">
        <div class="problemBox earthColor" id=problemBox0>
            <div class="problemTitle">Terra</div>
        </div>
        <div class="problemBox moonColor openProbler" id="problemBox1">
            <div class="problemTitle">Luna</div>
        </div>
        <div class="problemBox venusColor" id="problemBox2">
            <div class="problemTitle">Venere</div>
        </div>
        <div class="problemBox mercuryColor" id="problemBox3">
            <div class="problemTitle">Mercurio</div>
        </div>
        <div class="problemBox saturnColor" id="problemBox4">
            <div class="problemTitle">Saturno</div>
        </div>
        <div class="problemBox jupiterColor" id="problemBox5">
            <div class="problemTitle">Giove</div>
        </div>
        <div class="problemBox neptuneColor" id="problemBox6">
            <div class="problemTitle">Nettuno</div>
        </div>
        <div class="problemBox sunColor" id="problemBox7">
            <div class="problemTitle">Sole</div>
        </div>
        <div class="problemBox marsColor" id="problemBox8">
            <div class="problemTitle">Marte</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox9">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox10">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox11">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox12">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox13">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox14">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox15">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox16">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox17">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox18">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox19">
            <div class="problemTitle">Urano</div>
        </div>
        <div class="problemBox uranusColor" id="problemBox20">
            <div class="problemTitle">Urano</div>
        </div>
    </div>

    <div class="drag-drop-area drag-drop-area-highlight hide">
        <div class="drag-drop-area icon-container hide">
            <i class="drag-drop-area material-icons md-64 cloud-upload hide">cloud_upload</i>
            <!-- <i class="drag-drop-area material-icons md-64 file-upload hide">file_upload</i> -->
        </div>
        <div class="drag-drop-area drag-drop-area-message hide">Drop to upload</div>
    </div>

    <div class="content">
        <!-- https://stackoverflow.com/questions/9182978/semi-transparent-color-layer-over-background-image -->
        

        <div id="problemSub0" class="submissions">
            <h2 class="problemTitle">Terra</h2>
        </div>

        <div id="problemSub1" class="submissions hide">
            <h2 class="problemTitle">Luna</h2>
        </div>
        
        <div id="problemSub2" class="submissions hide">
            <h2 class="problemTitle">Venere</h2>
        </div>
        
        <div id="problemSub3" class="submissions hide">
            <h2 class="problemTitle">Mercurio</h2>
        </div>
        
        <div id="problemSub4" class="submissions hide">
            <h2 class="problemTitle">Saturno</h2>
        </div>
        
        <div id="problemSub5" class="submissions hide">
            <h2 class="problemTitle">Giove</h2>
        </div>
        
        <div id="problemSub6" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub7" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub8" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub9" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub10" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub11" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub12" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub13" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub14" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub15" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub16" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub17" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub18" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub19" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>

        <div id="problemSub20" class="submissions hide">
            <h2 class="problemTitle">Nettuno</h2>
        </div>
    </div>
    <script type="text/javascript">
        // this script automatically executes when the page finishes loading

        // checks if the clicked element should trigger the content change
        let changeDisplayProblemCondition = function (clickEventTarget){
            // if you clicked the problem statement link, the content must not change
            if (clickEventTarget.classList.contains('statementLink')) {
                return false;
            }

            // if you clicked anywhere on the problemBox AND it's not the one shown now
            // the content has to change
            if (clickEventTarget.classList.contains('problemBox') && !clickEventTarget.classList.contains('openProblem')){
                return true;
            }

            // if you click any element inside the problemBox, beside the problemStatement link
            // you have to check if the parent is the currently shown problem or not
            if (clickEventTarget.parentElement.classList.contains('problemBox') && !clickEventTarget.parentElement.classList.contains('openProblem')) {
                return true;
            }
            return false;
        };

        let isToggleUpload = function (target) {
            if (target.classList.contains('upload-toggle'))
                return true;

            if (target.parentElement.classList.contains('upload-toggle')) {
                return true;
            }

            return false;
        }


        // Event Delegation // https://davidwalsh.name/event-delegate
        // adding click event listener to the whole sidebar, instead of giving one to each element
        // the click event will bubble up to the sidebar, where the listener will pick it up and
        // the original target will be found inside the event properties
        document.querySelectorAll('div.sidebar')[0].addEventListener("click", function(event){
            // event.target = the thing you clicked
            let target = event.target;

            console.log(event);

            // change the shown problem
            // retracting the (now) extended problemBox
            // extending the selected problem's problemBox
            // hiding the (now) shown content
            // showing the selected problem's content

            if (changeDisplayProblemCondition(target) && !isToggleUpload(target)) {
                console.log('the stairs are changing!');

                let problemID = null;
                
                // if the click's target wasn't the problemBox, the problemId is stored in
                // the parent element's id
                if (!target.classList.contains('problemBox')) {
                    let parentID = target.parentElement.id;

                    // extract the problem number (e.g. 3) by replacing each leading non-digit character
                    // with nothing
                    problemID = parentID.replace( /^\D+/g, '');     // type string
                        // https://stackoverflow.com/questions/10003683/javascript-get-number-from-string
                        // D = non-digit
                        // g = global modifier (looks for every match instead of stopping at the first)
                        // https://www.w3schools.com/jsref/jsref_regexp_g.asp
                } else {
                    problemID = target.id.replace(/^\D+/g, '');
                }


                // to retract the now open problem box, retrieve the problem box list
                let problemBoxList = document.querySelectorAll('.problemBox');

                // check each problemBox if it has the 'openProblem' class
                for (let i=0; i<problemBoxList.length; i++){
                    // if the problemBox' list of classes contains the openProblem class
                    if (problemBoxList[i].classList.contains('openProblem')) {
                        // remove it
                        problemBoxList[i].classList.remove('openProblem');
                        break;
                    }
                    // #dev #improvement
                    // stop the loop to save time or close every problem box to be sure?
                }

                // open (extend) the new problem box by adding the class 'openProblem'
                document.getElementById('problemBox'+problemID).classList.add('openProblem');

                // #dev #improvement
                // search again for the shown content or just rely on the previously open problemBox?

                // find which content is now shown and hide it

                // get the list of every div containing the submission table
                let submissionsList = document.querySelectorAll('div.submissions');

                // check if each element has the 'hide' class
                // if it doesn't, add it
                for (let i=0; i<submissionsList.length; i++) {
                    if (!submissionsList[i].classList.contains('hide')) {
                        submissionsList[i].classList.add('hide');
                    }
                }

                // remove the hide class from the submission table of the problem I want to show
                document.getElementById('problemSub'+problemID).classList.remove('hide'); 
            }

            if (isToggleUpload (target)) {
                console.log ('toggle!');

                let ddarea = document.querySelectorAll('.drag-drop-area');

                for (let i=0; i<ddarea.length; i++) {
                    ddarea[i].classList.toggle('hide');
                }
            }
            // console.log(event.target.parentElement.id); // problem number through parent div ID
            // console.log(event);
        });

        let dragDropArea = document.querySelectorAll('div.content')[0];
        // let dragDropEvents = ['dragenter', 'dragover', 'dragleave', 'drop'];
        let dragDropEvents = ['dragenter', 'dragleave', 'drop'];

        function preventDefault (e) {
            e.preventDefault();
            e.stopPropagation();
            
            // let isContent = e.path.find( (obj) => {
            //     if (obj.localName == 'div' && obj.className == 'content') {
            //         return true;
            //     }
            //     return false;
            // } );

            // console.log (e.path);

            let isContent = false;

            console.log (e);
            
            // e.path.forEach( (obj) => {
            //     if (obj.localName == 'div' && obj.className == 'content') {
            //         isContent = true;
            //     }
            // });

            console.log (isContent);
        };

        // have to check if the event's target element has 'div.content' as parent
        // each event has the `path` property
        // https://www.linkedin.com/pulse/javascript-find-object-array-based-objects-property-rafael

        dragDropEvents.forEach(eventName => {
            dragDropArea.addEventListener(eventName, preventDefault, false);
        });

        dragDropArea.addEventListener('dragover', (event) => { event.preventDefault(); event.stopPropagation(); }, false);

        

    </script>  
</body>
</html>